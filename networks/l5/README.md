# Лабораторная работа №5 - Flask AJAX Калькулятор

## Описание

Лабораторная работа по веб-технологиям, демонстрирующая создание интерактивного веб-калькулятора с использованием Flask (backend) и AJAX (frontend). Поддерживает базовые арифметические операции, степенные функции и тригонометрические вычисления.

## Структура проекта

```
l5/
├── app.py                # Flask веб-приложение (backend)
├── static/               # Статические файлы (frontend)
│   ├── index.html       # HTML интерфейс калькулятора  
│   ├── main.js          # JavaScript логика и AJAX
│   └── styles.css       # CSS стили интерфейса
└── README.md            # Документация (этот файл)
```

## Функциональность

### Backend (`app.py`)
- **Flask сервер** для обработки вычислений
- **API endpoint**: `POST /api/calc` для математических операций
- **Статические файлы**: обслуживание HTML/CSS/JS
- **Обработка ошибок**: валидация входных данных и математические исключения

### Математические операции
- **Базовые арифметические**:
  - `add` - сложение (a + b)
  - `sub` - вычитание (a - b) 
  - `mul` - умножение (a × b)
  - `div` - деление (a ÷ b)
- **Степенные функции**:
  - `pow` - возведение в степень (a^b)
  - `root` - извлечение корня (корень b-й степени из a)
- **Тригонометрические функции**:
  - `sin` - синус (в градусах)
  - `cos` - косинус (в градусах)
  - `tan` - тангенс (в градусах)
  - `cot` - котангенс (в градусах)

### Frontend
- **HTML интерфейс** с полем ввода математических выражений
- **JavaScript AJAX** для асинхронных вычислений
- **Парсинг выражений** для удобного ввода
- **Отображение результатов** и ошибок
- **Responsive дизайн** с современным CSS

## Установка зависимостей

```bash
pip install Flask
```

## Запуск

### Запуск Flask сервера
```bash
python app.py
```

Сервер запустится на http://127.0.0.1:5000

### Доступ к приложению
Откройте браузер и перейдите по адресу: http://127.0.0.1:5000

## Использование

### Интерфейс калькулятора
- **Поле ввода**: введите математическое выражение в свободной форме (например, `2+2`, `root(16,4)`, `sin(45)`)
- **Автовычисление**: расчёт выполняется автоматически по мере ввода без отдельной кнопки
- **Поле результата**: read-only поле под выражением, в которое выводится ответ или текст ошибки
- **Ошибки**: отображаются в поле результата с префиксом `Ошибка:` и выделяются красным цветом
- **Неподдерживаемый ввод**: если выражение не распознано, запрос не отправляется, а поле результата очищается

### Примеры выражений

#### Базовые операции
```
2+3         # Результат: 5
10-4        # Результат: 6  
5*6         # Результат: 30
15/3        # Результат: 5
```

#### Степенные функции
```
2^8         # Результат: 256
3^4         # Результат: 81
root(27,3)  # Результат: 3 (кубический корень из 27)
root(16,4)  # Результат: 2 (корень 4-й степени из 16)
```

#### Тригонометрические функции
```
sin(30)     # Результат: 0.5
cos(60)     # Результат: 0.5
tan(45)     # Результат: 1
cot(45)     # Результат: 1
sin(90)     # Результат: 1
cos(0)      # Результат: 1
```

### API использование

#### Прямой вызов API
```bash
curl -X POST "http://127.0.0.1:5000/api/calc" \
     -H "Content-Type: application/x-www-form-urlencoded" \
     -d "op=add&op1=5&op2=3"
```

#### Ответ API
```json
{
  "ok": true,
  "result": 8
}
```

#### Обработка ошибок
```json
{
  "ok": false,
  "error": "Деление на ноль невозможно"
}
```

## Поддерживаемые форматы ввода

### Через веб-интерфейс
- `2+3` → преобразуется в `op=add, op1=2, op2=3`
- `10-5` → преобразуется в `op=sub, op1=10, op2=5`
- `sin(45)` → преобразуется в `op=sin, op1=45`
- `root(8,3)` → преобразуется в `op=root, op1=8, op2=3`

### Через API
- Параметры: `op`, `op1`, `op2` (op2 не требуется для унарных операций)
- Формат: `application/x-www-form-urlencoded`

## Обработка ошибок

### Математические ошибки
- **Деление на ноль**: "Деление на ноль невозможно"
- **Корень из отрицательного числа**: "Чётный корень из отрицательного числа не является вещественным"
- **Неопределённые значения**: "tan не определён для этого угла (cos≈0)" или "cot не определён для этого угла (sin≈0)"

### Ошибки ввода
- **Некорректные числа**: "Поле 'opX' должно быть числом"
- **Неизвестная операция**: "Неизвестная операция"
- **Пропущенные значения**: стандартные HTTP 400 ответы с конкретным описанием проблемы

## Технические особенности

### Backend (Flask)
- **Маршрутизация**: обслуживание статических файлов и API
- **Валидация**: проверка типов и математических ограничений
- **Обработка исключений**: try-catch блоки для всех вычислений
- **JSON ответы**: структурированные данные для frontend

### Frontend (JavaScript)
- **AJAX запросы**: асинхронная отправка данных с отменой предыдущих вычислений
- **Парсинг выражений**: регулярные выражения для разбора ввода
- **DOM манипуляции**: динамическое обновление интерфейса по мере набора
- **Event handling**: обработка события `input` в поле выражения без отправки формы

### CSS стилизация
- **Responsive дизайн**: адаптация под разные экраны
- **Современный интерфейс**: красивая типографика и отступы
- **Состояния элементов**: hover эффекты и transitions
- **Цветовая схема**: контрастные цвета для удобочитаемости

## Расширение функциональности

### Добавление новых операций
1. Добавьте операцию в `unary_ops` или `binary_ops` в `app.py`
2. Реализуйте вычисление в соответствующем блоке
3. Обновите парсер в `main.js` для поддержки нового синтаксиса

### Улучшение интерфейса
- Добавление кнопочного интерфейса
- История вычислений
- Сохранение результатов
- Научный режим с дополнительными функциями

## Цель работы

Изучение принципов создания интерактивных веб-приложений с использованием Flask и AJAX. Освоение асинхронного взаимодействия между frontend и backend, обработки пользовательского ввода и создания современного веб-интерфейса.