# Лабораторная работа №4 - TCP Client-Server для передачи файлов

## Описание

Лабораторная работа по компьютерным сетям, демонстрирующая создание TCP клиент-серверного приложения на C++ для передачи файлов. Реализует базовый протокол обмена файлами между клиентом и сервером с использованием Windows Sockets API.

## Структура проекта

```
Client-Server/
├── Client-Server.sln            # Solution файл Visual Studio
├── client/                      # Клиентское приложение
│   ├── client.cpp              # Исходный код клиента
│   ├── client.vcxproj          # Проект Visual Studio
│   ├── client.vcxproj.filters  # Фильтры проекта
│   └── downloaded_file         # Загруженный файл (создается автоматически)
├── Client-Server/               # Серверное приложение
│   ├── server.cpp              # Исходный код сервера
│   ├── Client-Server.vcxproj   # Проект Visual Studio
│   └── Client-Server.vcxproj.filters # Фильтры проекта
├── .gitignore                  # Игнорируемые файлы
└── README.md                   # Документация (этот файл)
```

## Функциональность

### Серверная часть (`server.cpp`)
- **TCP сервер** на порту 8080
- **Многопоточная обработка** клиентов
- **Команды**:
  - `upload` - получение файла от клиента
  - `download` - отправка файла клиенту
  - `exit` - завершение соединения
- **Автоматическое создание папки** uploads/ для сохранения файлов
- **Обработка ошибок** соединения и передачи данных

### Клиентская часть (`client.cpp`)
- **TCP клиент** для подключения к серверу
- **Интерактивный интерфейс** для выбора операций
- **Функции**:
  - Загрузка файла на сервер (`uploadFile`)
  - Скачивание файла с сервера (`downloadFile`)
  - Интерактивное взаимодействие с сервером
- **Валидация IP-адреса** сервера
- **Обработка сетевых ошибок**

## Компиляция и сборка

### Требования
- **Visual Studio** 2019/2022 или совместимая среда
- **Windows SDK** с поддержкой Winsock2
- **Библиотека ws2_32.lib** (подключается автоматически)

### Сборка через Visual Studio
1. Откройте `Client-Server.sln`
2. Выберите конфигурацию (Debug/Release)
3. Соберите решение (Build → Build Solution)

### Сборка через командную строку
```bash
# Для сервера
cl server.cpp ws2_32.lib

# Для клиента  
cl client.cpp ws2_32.lib
```

## Запуск

### 1. Запуск сервера
```bash
# Из папки Client-Server
./Client-Server.exe
```

Сервер запустится на порту 8080 и будет ожидать подключений.

### 2. Запуск клиента
```bash
# Из папки client
./client.exe
```

При запуске клиент запросит IP-адрес сервера:
```
Введите IP-адрес сервера: 127.0.0.1
```

## Использование

### Интерфейс клиента
После подключения к серверу доступны команды:
```
Выберите действие:
1. Загрузить файл на сервер
2. Скачать файл с сервера
3. Выйти
Ваш выбор:
```

### Загрузка файла на сервер
1. Выберите опцию `1`
2. Введите путь к файлу для загрузки
3. Файл будет передан на сервер и сохранен в папке `uploads/`

### Скачивание файла с сервера
1. Выберите опцию `2`
2. Файл будет загружен с сервера и сохранен как `downloaded_file`

## Протокол взаимодействия

### Команды клиента серверу
- `upload\n` - запрос на загрузку файла
- `download\n` - запрос на скачивание файла
- `exit\n` - завершение соединения

### Передача файлов
1. **Upload**: клиент отправляет команду, затем содержимое файла
2. **Download**: клиент отправляет команду, сервер отправляет файл
3. **Буферизация**: данные передаются блоками по 1024 байта

## Пример работы

### Консоль сервера
```
Сервер запущен на порту 8080...
Ожидание подключений...
Клиент подключился.
Получена команда: upload
Файл получен и сохранен как uploads/uploaded_file
Получена команда: download
Файл отправлен клиенту.
Клиент отключился.
```

### Консоль клиента
```
Введите IP-адрес сервера: 127.0.0.1
Подключение к серверу успешно.

Выберите действие:
1. Загрузить файл на сервер
2. Скачать файл с сервера
3. Выйти
Ваш выбор: 1

Введите путь к файлу: test.txt
Ответ сервера: Файл успешно получен.

Выберите действие:
1. Загрузить файл на сервер
2. Скачать файл с сервера  
3. Выйти
Ваш выбор: 2

Файл успешно загружен с сервера (сохранен как 'downloaded_file').
```

## Особенности реализации

- **Windows Sockets API** для сетевого взаимодействия
- **TCP протокол** для надежной передачи данных
- **Буферизованная передача** для эффективности
- **Обработка ошибок** на всех этапах
- **Простой текстовый протокол** для команд
- **Бинарная передача** файлов любого типа

## Ограничения

- Работает только на **Windows** (использует Winsock2)
- Сервер обрабатывает **одного клиента** за раз
- Передается только **один файл** за сессию download
- Нет **аутентификации** или шифрования
- Размер буфера ограничен **1024 байтами**

## Цель работы

Изучение основ сетевого программирования с использованием TCP сокетов. Освоение принципов клиент-серверной архитектуры, протоколов передачи данных и обработки сетевых соединений на низком уровне.