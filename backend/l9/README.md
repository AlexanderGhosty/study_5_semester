# Лабораторная работа №9 - SQLAlchemy + FastAPI с HTML шаблонами

## Описание

Лабораторная работа по изучению интеграции SQLAlchemy ORM с FastAPI для создания веб-приложения с базой данных. Демонстрирует CRUD операции, работу с HTML шаблонами и создание полноценного веб-интерфейса для управления пользователями и постами.

## Структура проекта

```
l9/
├── app/
│   ├── main.py          # Основное FastAPI приложение с маршрутами
│   ├── database.py      # Конфигурация базы данных и сессий
│   ├── models.py        # SQLAlchemy модели (User, Post)
│   ├── schemas.py       # Pydantic схемы для валидации
│   ├── crud_scripts.py  # CRUD операции и демонстрационные данные
│   └── templates/       # HTML шаблоны Jinja2
│       ├── base.html    # Базовый шаблон
│       ├── users_list.html    # Список пользователей
│       ├── users_form.html    # Форма пользователя
│       ├── posts_list.html    # Список постов
│       └── posts_form.html    # Форма поста
├── run_crud_demo.py     # Скрипт для демонстрации CRUD операций
└── README.md           # Документация (этот файл)
```

## Функциональность

### 1. Модели данных (`models.py`)
- **User**: пользователи с полями id, username, email, password
- **Post**: посты с полями id, title, content, user_id (связь с пользователем)
- Отношения между моделями (один-ко-многим)

### 2. База данных (`database.py`)
- Конфигурация SQLite базы данных
- Управление сессиями
- Автоматическое создание таблиц

### 3. Веб-интерфейс (`main.py`)
- **Пользователи**:
  - Просмотр списка пользователей
  - Создание нового пользователя
  - Редактирование пользователя
  - Удаление пользователя
- **Посты**:
  - Просмотр списка постов с авторами
  - Создание нового поста
  - Редактирование поста
  - Удаление поста

### 4. API эндпоинты
- **HTML маршруты**: для веб-интерфейса
- **JSON API**: для программного доступа
- Валидация данных через Pydantic схемы

### 5. CRUD операции (`crud_scripts.py`)
- Создание демонстрационных данных
- Примеры различных запросов к базе данных
- Демонстрация отношений между таблицами

## Установка зависимостей

```bash
pip install fastapi uvicorn sqlalchemy jinja2 python-multipart
```

## Запуск

### Запуск веб-приложения
```bash
# Из корня проекта
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

### Запуск CRUD демо
```bash
python run_crud_demo.py
```

## Использование

### Веб-интерфейс
После запуска приложения откройте браузер:
- http://localhost:8000/users - управление пользователями
- http://localhost:8000/posts - управление постами

### API эндпоинты

#### Пользователи
- `GET /users` - HTML список пользователей
- `GET /users/new` - HTML форма создания пользователя
- `POST /users` - создание пользователя
- `GET /users/{id}/edit` - HTML форма редактирования
- `PUT /users/{id}` - обновление пользователя
- `DELETE /users/{id}` - удаление пользователя

#### Посты
- `GET /posts` - HTML список постов
- `GET /posts/new` - HTML форма создания поста
- `POST /posts` - создание поста
- `GET /posts/{id}/edit` - HTML форма редактирования
- `PUT /posts/{id}` - обновление поста
- `DELETE /posts/{id}` - удаление поста

#### JSON API
- `GET /api/users` - список пользователей (JSON)
- `POST /api/users` - создание пользователя (JSON)
- `GET /api/posts` - список постов (JSON)
- `POST /api/posts` - создание поста (JSON)

## Пример CRUD операций

### Создание пользователя через API
```bash
curl -X POST "http://localhost:8000/api/users" \
     -H "Content-Type: application/json" \
     -d '{
       "username": "john_doe",
       "email": "john@example.com",
       "password": "secret123"
     }'
```

### Создание поста
```bash
curl -X POST "http://localhost:8000/api/posts" \
     -H "Content-Type: application/json" \
     -d '{
       "title": "Мой первый пост",
       "content": "Содержание поста...",
       "user_id": 1
     }'
```

### Получение списка постов с авторами
```bash
curl -X GET "http://localhost:8000/api/posts"
```

## Демонстрационные данные

При запуске `run_crud_demo.py` создаются:
- 3 тестовых пользователя
- 5 тестовых постов
- Примеры различных запросов к базе данных

## Особенности реализации

- **SQLAlchemy ORM** для работы с базой данных
- **Jinja2 шаблоны** для генерации HTML
- **Pydantic схемы** для валидации данных
- **Отношения между моделями** (Foreign Key)
- **Автоматическая миграция** таблиц при запуске
- **Обработка ошибок** с информативными сообщениями
- **Responsive дизайн** в HTML шаблонах

## Цель работы

Изучение интеграции ORM (SQLAlchemy) с веб-фреймворком (FastAPI) для создания полноценного веб-приложения с базой данных. Освоение CRUD операций, работы с отношениями между таблицами и создания пользовательского интерфейса.